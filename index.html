<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Arrendamiento</title>
  <link rel="stylesheet" href="styles.css">
  <script>
    function calcularArrendamiento() {
      const costoPorHectarea = parseFloat(document.getElementById("costoPorHectarea").value.replace(/,/g, '')) / 10;
      const cantidadHectareas = parseInt(document.getElementById("cantidadHectareas").value);
      const flete = parseFloat(document.getElementById("flete").value);
      const comision = parseFloat(document.getElementById("comision").value) / 100;
      const interesMensual = parseFloat(document.getElementById("interes").value) / 100;
      const fechasSocio1 = document.getElementById("fechasSocio1").value.split(",").map(f => f.trim());
      const fechasSocio2 = document.getElementById("fechasSocio2").value.split(",").map(f => f.trim());

      const importeComsion = costoPorHectarea * comision;
      const total = (costoPorHectarea - flete - importeComsion) * cantidadHectareas;
      const totalSocio1 = total / 2;
      const totalSocio2 = total / 2;

      const parseFecha = (fecha) => {
        const [dia, mes, anio] = fecha.split("/").map(Number);
        return new Date(anio, mes - 1, dia);
      };

      const calcularInteres = (capital, fechaVencimiento) => {
        const fechaActual = new Date();
        const fechaPago = parseFecha(fechaVencimiento);
        const diasDiferencia = Math.floor((fechaPago - fechaActual) / (1000 * 60 * 60 * 24));
        const tasa = (interesMensual / 30) * diasDiferencia;
        const interes = (capital * tasa);
        return { capital, diasDiferencia, interes, monto: capital + interes };
      };

      const pagosSocio1 = fechasSocio1.map((fecha) => {
        const capital = totalSocio1 / fechasSocio1.length;
        const { capital: cap, diasDiferencia, interes, monto } = calcularInteres(capital, fecha);
        return { fecha, diasDiferencia, capital: cap, interes, monto };
      });

      const pagosSocio2 = fechasSocio2.map((fecha) => {
        const capital = totalSocio2 / fechasSocio2.length;
        const { capital: cap, diasDiferencia, interes, monto } = calcularInteres(capital, fecha);
        return { fecha, diasDiferencia, capital: cap, interes, monto };
      });

      document.getElementById("resultadoCostoPorHectarea").innerText = costoPorHectarea.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      document.getElementById("resultadoComision").innerText = (importeComsion * cantidadHectareas).toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      document.getElementById("resultadoFlete").innerText = (flete * cantidadHectareas).toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      document.getElementById("resultadoImporteLiquidacion").innerText = total.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

      const tablaSocio1 = document.getElementById("tablaSocio1");
      const tablaSocio2 = document.getElementById("tablaSocio2");

      tablaSocio1.innerHTML = "<tr><th>Fecha</th><th>Días</th><th>Capital</th><th>Interés</th><th>Monto</th></tr>";
      tablaSocio2.innerHTML = "<tr><th>Fecha</th><th>Días</th><th>Capital</th><th>Interés</th><th>Monto</th></tr>";

      let totalCapital1 = 0, totalInteres1 = 0, totalMonto1 = 0;
      pagosSocio1.forEach(pago => {
        totalCapital1 += pago.capital;
        totalInteres1 += pago.interes;
        totalMonto1 += pago.monto;
        const row = tablaSocio1.insertRow();
        row.innerHTML = `
          <td>${pago.fecha}</td>
          <td>${pago.diasDiferencia}</td>
          <td>${pago.capital.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
          <td>${pago.interes.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
          <td>${pago.monto.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>`;
      });

      let totalCapital2 = 0, totalInteres2 = 0, totalMonto2 = 0;
      pagosSocio2.forEach(pago => {
        totalCapital2 += pago.capital;
        totalInteres2 += pago.interes;
        totalMonto2 += pago.monto;
        const row = tablaSocio2.insertRow();
        row.innerHTML = `
          <td>${pago.fecha}</td>
          <td>${pago.diasDiferencia}</td>
          <td>${pago.capital.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
          <td>${pago.interes.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
          <td>${pago.monto.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>`;
      });

      tablaSocio1.insertRow().innerHTML = `
        <td><strong>Total</strong></td>
        <td></td>
        <td><strong>${totalCapital1.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</strong></td>
        <td><strong>${totalInteres1.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</strong></td>
        <td><strong>${totalMonto1.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</strong></td>`;

      tablaSocio2.insertRow().innerHTML = `
        <td><strong>Total</strong></td>
        <td></td>
        <td><strong>${totalCapital2.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</strong></td>
        <td><strong>${totalInteres2.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</strong></td>
        <td><strong>${totalMonto2.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</strong></td>`;
    }
  </script>
</head>
<body>
  <h1>Calculadora de Arrendamiento</h1>
  <form onsubmit="calcularArrendamiento(); return false;">
    <label for="costoPorHectarea">Precio Soja Pizarra Rosario:</label>
    <input type="text" id="costoPorHectarea" required><br>
    <label for="cantidadHectareas">Quintales a Liquidar:</label>
    <input type="number" id="cantidadHectareas" required><br>
    <label for="flete">Flete:</label>
    <input type="number" id="flete" step="0.01" required><br>
    <label for="comision">Comisión (%):</label>
    <input type="number" id="comision" step="0.01" required><br>
    <label for="interes">Interés Mensual (%):</label>
    <input type="number" id="interes" step="0.01" required><br>
    <label for="fechasSocio1">Fechas de pagos para Familia Ageno (separadas por coma):</label>
    <input type="text" id="fechasSocio1" required><br>
    <label for="fechasSocio2">Fechas de pagos para Familia Vigano (separadas por coma):</label>
    <input type="text" id="fechasSocio2" required><br>
    <input type="submit" value="Calcular">
  </form>
  <h2>Resultados</h2>
  <table>
    <tr>
      <th>Precio Cereal (qq)</th>
      <th>Comisión</th>
      <th>Flete</th>
      <th>Importe de Liquidación</th>
    </tr>
    <tr>
      <td id="resultadoCostoPorHectarea"></td>
      <td id="resultadoComision"></td>
      <td id="resultadoFlete"></td>
      <td id="resultadoImporteLiquidacion"></td>
    </tr>
  </table>
  <h2>Pagos Familia Ageno</h2>
  <table id="tablaSocio1"></table>
  <h2>Pagos Familia Vigano</h2>
  <table id="tablaSocio2"></table>
</body>
</html>
